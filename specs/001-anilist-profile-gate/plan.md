# Implementation Plan: AniList Profile Gate & Information Browser

**Branch**: `001-anilist-profile-gate` | **Date**: 2025-10-24 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-anilist-profile-gate/spec.md`

**Note**: This file is generated by the `/speckit.plan` command.

## Summary

Build a Next.js 15 web application that gates access behind a profile collection form (username + job title stored in localStorage), then displays paginated anime data from the AniList GraphQL API. The information page supports deep linking via ?page=N query parameters, displays items in a responsive grid with images, and opens detailed views in accessible modals. All pages include a footer showing "Challenge version v3.5". Deploy to Vercel with WCAG AA compliance, TypeScript strict mode, and comprehensive testing.

## Technical Context

**Language/Version**: TypeScript 5.x with strict mode enabled
**Primary Dependencies**: Next.js 15 (App Router), React 18+, Apollo Client 3.x, shadcn/ui, Tailwind CSS 3.x, Zod 3.x
**Storage**: Browser localStorage for profile data; Apollo InMemoryCache for GraphQL data
**Testing**: Vitest + React Testing Library (unit/component), Playwright (e2e)
**Target Platform**: Modern web browsers (Chrome 90+, Firefox 88+, Safari 14+, Edge 90+), Vercel deployment
**Project Type**: Web application (single frontend, no backend)
**Performance Goals**: TTI < 1s, FCP < 1.5s, LCP < 2.5s, CLS < 0.1; pagination load < 2s
**Constraints**: 90 requests/min to AniList API, WCAG AA compliance, no authentication required
**Scale/Scope**: ~50 anime items per page, 20 items displayed per page (fixed), ~5 main components, ~10 utility functions

## Constitution Check

_GATE: Must pass before Phase 0 research. Re-check after Phase 1 design._

### Technology Stack Compliance

- [x] **React + Next.js 15**: Using App Router with `/app` directory structure for routing and SSR
- [x] **shadcn/ui + Tailwind**: UI components (Dialog, Button, Input, Card) with Tailwind CSS for styling
- [x] **Apollo Client**: GraphQL integration with AniList API, InMemoryCache with type policies for pagination
- [x] **TypeScript Strict**: All code in strict mode with GraphQL Code Generator for type safety
- [x] **Zod Validation**: Runtime validation for profile inputs, localStorage data, and API responses

### Quality Standards Compliance

- [x] **Documentation**: Inline comments for non-obvious logic, README with install/run/build/deploy instructions
- [x] **Accessibility**: WCAG AA with keyboard navigation, focus management (especially modals), color contrast ratios
- [x] **Testing**: Vitest + RTL for components, Playwright for e2e (profile submit → data load → pagination flow)
- [x] **Performance**: TTI < 1s via code splitting, image optimization, pagination (12-20 items/page), Apollo caching
- [x] **Security**: No secrets, HTML sanitization with DOMPurify, SSR-safe localStorage access (client-side only)

### Architecture Compliance

- [x] **Mobile-First**: Responsive grid (1-col mobile, multi-col desktop), touch-friendly controls, mobile-tested modals
- [x] **Minimal Dependencies**: Only essential packages (Next.js, Apollo, shadcn/ui, Tailwind, Zod, DOMPurify)
- [x] **Performance Budget**: Bundle size monitoring, lazy loading for modals, optimized images, efficient re-renders

## Project Structure

### Documentation (this feature)

```text
specs/001-anilist-profile-gate/
├── plan.md              # This file (/speckit.plan command output)
├── research.md          # Phase 0 output (Apollo setup, GraphQL codegen, accessibility patterns)
├── data-model.md        # Phase 1 output (Profile, MediaItem, PageInfo schemas)
├── quickstart.md        # Phase 1 output (install, run, test, deploy instructions)
├── contracts/           # Phase 1 output (GraphQL queries, Zod schemas)
│   ├── anilist.graphql  # AniList Page query
│   └── schemas.ts       # Zod validation schemas
└── tasks.md             # Phase 2 output (/speckit.tasks command - NOT created by /speckit.plan)
```

### Source Code (repository root)

```text
app/
├── layout.tsx           # Root layout with Footer component
├── page.tsx             # Profile gate page (/)
└── information/
    └── page.tsx         # Information page with pagination (/information?page=N)

components/
├── ProfileForm.tsx      # Profile collection form with validation
├── ProfileEditor.tsx    # Profile edit interface
├── MediaGrid.tsx        # Responsive grid of media items
├── MediaCard.tsx        # Individual media item card
├── MediaModal.tsx       # Modal dialog for item details
├── Pagination.tsx       # Pagination controls with ellipsis
└── Footer.tsx           # Global footer with challenge version

lib/
├── schema.ts            # Zod models (Profile, MediaItem, PageInfo)
├── storage.ts           # localStorage utilities with SSR safety
├── graphql/
│   ├── client.ts        # Apollo Client configuration
│   ├── queries.ts       # GraphQL queries (Page query)
│   └── generated/       # GraphQL Code Generator output (types, hooks)
│       ├── schema.ts
│       └── operations.ts
└── hooks/
    ├── useProfile.ts    # Profile CRUD operations (localStorage)
    ├── useMediaPage.ts  # Custom hook: useQuery → transform to MediaItem[]
    └── usePagination.ts # Pagination state management with URL sync

tests/
├── unit/
│   ├── storage.test.ts
│   ├── schema.test.ts
│   └── hooks.test.ts
└── components/
    ├── ProfileForm.test.tsx
    ├── MediaGrid.test.tsx
    ├── MediaModal.test.tsx
    └── Pagination.test.tsx

e2e/
├── profile-gate.spec.ts      # E2E: gate → form submit → redirect
├── pagination.spec.ts        # E2E: page navigation, deep linking
└── modal-interaction.spec.ts # E2E: item click → modal open → close

public/
└── (static assets)

.env.local                     # Environment variables (NEXT_PUBLIC_CHALLENGE_VERSION=3.5)
next.config.js                 # Next.js configuration
tailwind.config.js             # Tailwind configuration with shadcn/ui
tsconfig.json                  # TypeScript configuration (strict mode)
vitest.config.ts               # Vitest configuration
playwright.config.ts           # Playwright configuration
codegen.yml                    # GraphQL Code Generator configuration
```

**Structure Decision**: Single web application using Next.js 15 App Router. The `/app` directory contains page routes (`/` for profile gate, `/information` for data browser). Components are organized by function (profile, media display, pagination). The `lib/` directory houses business logic (GraphQL client, schemas, hooks). Testing structure mirrors source with unit, component, and e2e separation.

## Complexity Tracking

> **All constitution checks passed - no violations to justify**
